apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: smoke-test-
  annotations:
    description: "Smoke test workflow to verify basic Argo Workflows functionality"
spec:
  entrypoint: smoke-test
  arguments:
    parameters:
    - name: test-timeout
      value: "30"
  templates:
  - name: smoke-test
    dag:
      tasks:
      - name: basic-container
        template: basic-container-test
      - name: script-test
        template: script-test
      - name: parameter-test
        template: parameter-test
        arguments:
          parameters:
          - name: test-param
            value: "smoke-test-value"
      - name: artifact-test
        template: artifact-test
  - name: basic-container-test
    container:
      image: alpine:3.18
      command: [sh, -c]
      args: |
        echo "ðŸ§ª Running basic container test..."
        echo "âœ… Container execution works"
        echo "âœ… Image pulling works"
        echo "âœ… Command execution works"
        echo "Test completed successfully"
      resources:
        requests:
          memory: "32Mi"
          cpu: "100m"
        limits:
          memory: "64Mi"
          cpu: "200m"
  - name: script-test
    script:
      image: alpine:3.18
      command: [sh]
      source: |
        echo "ðŸ§ª Running script test..."
        echo "âœ… Script execution works"
        echo "âœ… Variable substitution works: {{workflow.parameters.test-timeout}}"
        echo "âœ… File operations work"
        echo "test-data" > /tmp/test-file.txt
        cat /tmp/test-file.txt
        echo "Script test completed successfully"
      resources:
        requests:
          memory: "32Mi"
          cpu: "100m"
        limits:
          memory: "64Mi"
          cpu: "200m"
  - name: parameter-test
    inputs:
      parameters:
      - name: test-param
    container:
      image: alpine:3.18
      command: [sh, -c]
      args: |
        echo "ðŸ§ª Running parameter test..."
        echo "âœ… Parameter passing works: {{inputs.parameters.test-param}}"
        echo "âœ… Template parameter substitution works"
        echo "Parameter test completed successfully"
      resources:
        requests:
          memory: "32Mi"
          cpu: "100m"
        limits:
          memory: "64Mi"
          cpu: "200m"
  - name: artifact-test
    container:
      image: alpine:3.18
      command: [sh, -c]
      args: |
        echo "ðŸ§ª Running artifact test..."
        echo "âœ… Container can write files"
        echo "test-artifact-data" > /tmp/artifact.txt
        echo "âœ… File creation works"
        ls -la /tmp/artifact.txt
        echo "Artifact test completed successfully"
      resources:
        requests:
          memory: "32Mi"
          cpu: "100m"
        limits:
          memory: "64Mi"
          cpu: "200m"
