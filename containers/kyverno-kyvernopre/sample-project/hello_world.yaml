# Kyverno Hello World Example
# This demonstrates basic Kyverno policy creation and validation

apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: hello-world-policy
  annotations:
    policies.kyverno.io/title: Hello World Policy
    policies.kyverno.io/category: Sample
    policies.kyverno.io/severity: low
    policies.kyverno.io/description: >-
      A simple hello world policy that demonstrates basic Kyverno functionality.
      This policy ensures all pods have a hello-world label.
spec:
  validationFailureAction: enforce
  background: true
  rules:
  - name: require-hello-world-label
    match:
      any:
      - resources:
          kinds:
          - Pod
    validate:
      message: "All pods must have a hello-world label"
      pattern:
        metadata:
          labels:
            hello-world: "true"
---
# Test pod to validate the policy
apiVersion: v1
kind: Pod
metadata:
  name: hello-world-test-pod
  labels:
    hello-world: "true"
    app: test
spec:
  containers:
  - name: hello-world
    image: busybox:latest
    command: ["echo", "Hello, Kyverno!"]
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
  restartPolicy: Never
---
# This pod should be rejected by the policy (missing hello-world label)
apiVersion: v1
kind: Pod
metadata:
  name: hello-world-test-pod-invalid
  labels:
    app: test
    # Missing hello-world label - this should be rejected
spec:
  containers:
  - name: hello-world
    image: busybox:latest
    command: ["echo", "This pod should be rejected!"]
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
  restartPolicy: Never
